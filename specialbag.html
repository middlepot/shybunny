<html>

<!--
　　　          ___   .--.
　　　    .--.-"   "-' .- |
　　　   / .-,`          .'   
　　　   \   `           \ 　　　　　　。・゜ 　♡   。　　・　゜ 　　　♡  
　　　    '.            ・ \　　　　　　　　　　　　　　　　　　　　　　　　♡　　　　♡ ゜・。。♡  
　　　      |  ・     ᴥ    。|　　　　・゜♡ ゜・。　　. * ・ ♡ °  . 。
　　　      \ 。            /.____　　　　　　　　　　　　　　　　　　♡.  
　　　     /`-.          ,'.'    `\　　　　　　　　　　　　　　　　　　。・゜　　　 ♡ ・ 。　　。・゜ ♡  
　　　  __/   \`-.____.-' `\      /　　　　　♡　。・゜      
　　　  | `---`'-'._/-`     \----'    _ 　　　　　　　　　　　 ♡　　　.　　　.♡ 
　　　  |,-'`  /             |    _.-' `\　　　　. * ・        
　　　 .'     /              |--'`     / |　　　　　　　　　　 ♡
　　　/      /\              `         | |
　　　|   .\/  \      .--. __          \ |　　　　　© middlepot.com  ꒰ ू´ ˘ ` ू ꒱
　　　 '-'      '._       /  `\         /
　　　             `\    '     |------'`　　　　。・゜　　　 ♡ ・ 。　　。・゜ ♡  
　　　               \  |      |
　　　                \        /　　　　　 ♡　　　.　　　.♡              . * ・  ♡
 　　　                '._  _.'
-->

<title>shy bunny store ꒱</title>

<head>
<link rel="shortcut icon" href="./img/favicon.png">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="robots" content="nosnippet">
<meta name="robots" content="max-snippet:0">
<meta name="robots" content="noarchive">
<meta name="robots" content="notranslate">
<meta name="robots" content="nositelinkssearchbox">
<meta name="robots" content="max-video-preview:0">
<meta name="robots" content="max-image-preview:standard">
<meta name="title" content="ꔫ">
<meta name="description" content="shy bunny store ꒱">
<meta name="theme-color" content="#fefbfb">
<meta name="url" content="https://shybunny.store">
<meta name="identifier-URL" content="https://shybunny.store">
<meta name="thumbnail" content="https://shybunny.store/img/logo.jpg">
<meta property="og:url" content="https://shybunny.store">
<meta property="og:title" content="ꔫ">
<meta property="og:site_name" content="shybunny.store">
<meta property="og:description" content="shy bunny store ꒱">
<meta property="og:image" content="https://shybunny.store/img/logo.jpg">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:type" content="website">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://shybunny.store">
<meta property="twitter:title" content="ꔫ">
<meta property="twitter:description" content="shy bunny store ꒱">
<meta property="twitter:image" content="https://shybunny.store/img/logo.jpg">
<meta name="creation_date" content="october 18, 2018">
<meta name="author" content="middlepot, letters@middlepot.com">
<meta name="designer" content="middlepot, letters@middlepot.com">
<meta name="owner" content="middlepot, letters@middlepot.com">
<meta name="copyright" content="poofties © middlepot">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "OnlineStore",
  "name": "shybunny.store",
  "alternateName": "ꔫ",
  "description": "shy bunny store ꒱",
  "url": "https://shybunny.store",
  "logo": "https://shybunny.store/img/logo.jpg",
  "foundingDate": "2018-10-18",
  "identifier": "poofties © middlepot",
  "founder": {
            "@type": "Person",
            "name": "middlepot",
            "email": "letters@middlepot.com",
            "url": "https://middlepot.com",
            "image": "https://middlepot.com/img/melissa.jpg",
            "birthDate": "1997-08-11",
            "jobTitle": "artist, crafter & designer",
            "brand": {
                  "@type": "Brand",
                  "name": "poofties™",
                  "alternateName": "poofties.club",
                  "url": "https://poofties.club",
                  "logo": "https://poofties.club/img/logo.jpg"
                  }
         }
}
</script>

<meta name="google-site-verification" content="oeNF1rwRb131oa5qR8WVVfiQTt36bZAq1i0EVXafmnE" />

<style>
body{ 
  cursor: url(./img/cursor.png), progress;}
a:hover, .hoverable:hover{cursor: url(./img/cursorhover.png), progress;}
 ::selection {text-shadow: 0 0 2px #cec1bb;color:#cec1bb}
 ::-moz-selection {text-shadow: 0 0 2px #cec1bb;color:#cec1bb}
</style>

<style>
	table, tr, td{
		text-align: center;
		font-size: 9pt;
		height: 50px;
		margin: 0;
		padding: 0;
	}
</style>

<style type="text/css">
::-webkit-scrollbar {
width: 5px;
height: 4px;
background: transparent;
}
::-webkit-scrollbar-thumb {
background-color: #fcf7f7;
-webkit-border-radius: 3ex;
border-radius: 3ex;
border: 1px dotted #baaeab;
}
</style>
<style>
html {
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
}

@media screen and (max-width: 1000px) and (orientation: landscape){
#everything { position: absolute; zoom: 85%; left:-100px; top:0px;}
}

@supports not (-webkit-touch-callout: none) {
@media screen and (min-width: 1px) and (orientation: portrait){
#everything { position: absolute; zoom: 255%;
	left:-350px; top:70px;}
}}
@supports (-webkit-touch-callout: none) {
@media screen and (min-width: 1px) and (orientation: portrait){
#everything { position: absolute; zoom: 160%;
	left:-350px; top:20px;}
html{-webkit-text-size-adjust: 160%; text-size-adjust: 160%;}
}}

@media screen and (min-width: 1700px) and (orientation: landscape){
#everything { position: absolute; zoom: 120%;
	left:150px;
	top:40px; }
}

@media screen and (min-width: 2000px) and (orientation: landscape){
#everything { position: absolute; zoom: 170%;
	left:-150px; top:10px;}
}

@supports not (-webkit-touch-callout: none) {
@media screen and (max-width: 2000px) and (orientation: portrait){
#everything { position: absolute; zoom: 160%;
	left:-350px; top:20px;}
}}
@supports (-webkit-touch-callout: none) {
@media screen and (max-width: 2000px) and (orientation: portrait){
#everything { position: absolute; zoom: 160%;
	left:-350px; top:20px;}
html{-webkit-text-size-adjust: 160%; text-size-adjust: 160%;}
}}

@media screen and (min-width: 3000px) and (orientation: landscape){
#everything { position: absolute; zoom: 240%;
	left:150px;
	top:40px; }
}
</style>

<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
<script src="js/jimp.js"></script>
<script src="js/cookies.js"></script>
<script src="js/store-variables-1.0.js"></script>
<script src="js/util.js"></script>

</head>

<body ondragstart="return false" style="background-image:url(./img/bg.png); background-repeat: repeat; font-family: Calibri; font-size: 11px; letter-spacing:1px; color:#998585; white-space: nowrap;"><img src="https://shybunny.store/img/logo.jpg" alt="shybunny.store logo thumbnail preview main image" style="display:none">
<div id="everything">

<script>
	function validateEmail(email) {
		var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
		var test = re.test(String(email).toLowerCase());
		var mailValidatorEl = document.getElementById('emailvalidator');
		if(test){
			mailValidatorEl.src = 'img/couponok.png';
		}
		else{
			mailValidatorEl.src = 'img/couponwrong.png';
			var mailInputEl = document.getElementById('buyermail');
			mailInputEl.placeholder = 'please type a valid email !';
		}
		mailValidatorEl.style.display = 'block';
		return test;
	}

	function getCritterType(item){
		for(const [CRITTER] of Object.entries(critters)){
			if(item.critter === critters[CRITTER].NAME){
				return CRITTER;
			}
		}
	}

	//returns the weight of ithe item
	function getItemWeight(cat){
		for(const [CATEGORY] of Object.entries(categories)){
			if(cat === categories[CATEGORY].CATEGORY){
				return categories[CATEGORY].WEIGHT;
			}
		}
	}

	//returns the weight of ithe item
	function getItemPrice(cat){
		for(const [CATEGORY] of Object.entries(categories)){
			if(cat === categories[CATEGORY].CATEGORY){
				return categories[CATEGORY].PRICE;
			}
		}
	}

	//iterate over cart to evaluate shipping
	function calculateShipping(){
		var packagePrice = 5;
		var packageMaxWeight = 50;
		var finalPrice = 0;
		var packageCount = 1;
		var insidePackage = 0;
		cart_items.forEach(item =>{
			if(item){
				for(const [ITEM] of Object.entries(categories)){
					if(item.category === categories[ITEM].CATEGORY){
						insidePackage += categories[ITEM].WEIGHT;
						if(insidePackage > packageMaxWeight){
							insidePackage = categories[ITEM].WEIGHT;
							packageCount += 1;
						}
						break;
					}
				}
			}
		});
		if(packageCount >= 5)
			finalPrice += 30; //30usd for a box
		else
			finalPrice = (packagePrice*packageCount);
		var mode = packageCount+' package';
		if(packageCount > 1)
			mode += 's';
		var boxes = Math.floor(packageCount/5);
		if(boxes > 0){
			mode = '1 box';
		}
		return {total: finalPrice, mode: mode};
	}

	//iterate over cart to evaluate price
	function calculateItemsPrice(){
		var finalPrice = 0;
		cart_items.forEach(item =>{
			if(item){
				for(const [ITEM] of Object.entries(categories)){
					if(item.category === categories[ITEM].CATEGORY){
						finalPrice += categories[ITEM].PRICE;
						break;
					}
				}
			}
		});
		return finalPrice;
	}

	async function calculateFinalPrice(){
		//sets shipping fee
		var shipping = calculateShipping();
		var shippingEl = document.getElementById('shipping-total');
		shippingEl.innerHTML = '$ '+shipping.total+' usd ( ' + shipping.mode + ' )';
		//gets final price
		var total = (calculateItemsPrice()+shipping.total);
		var totalDiscounted = total*(1-(appliedDiscount/100));
		var totalFloat = parseFloat(total);
		var totalDiscountedFloat = parseFloat(totalDiscounted);
		if(totalDiscountedFloat % 1 !== 0)
			totalDiscountedFloat = totalDiscountedFloat.toFixed(2);
		
		var totalEl = document.getElementById('grand-total');
		if(!appliedDiscount || appliedDiscount <= 0){
			totalEl.innerHTML = '$ '+totalFloat+' usd';
			return totalFloat;
		}
		else{
			totalEl.innerHTML = '$ <span style="text-decoration: line-through;">'+totalFloat+'</span> '+totalDiscountedFloat+' usd';
			return parseFloat(totalDiscounted);
		}
	}
	
	function removeFromCart(){
		var clicked = $(this).closest('td').parent()[0].sectionRowIndex;
		if(clicked >= 0){
			cart_items.splice(clicked, 1);
			setCookie("cart_items", JSON.stringify(cart_items));
			updateCart();
		}
	}
	
	async function updateCart(){
		//pomisify jimp image creation
		var JimpCreate = (w, h) => new Promise((resolve) => {new Jimp(w, h, function(err, img){resolve(img);})});
		var prevEl = document.getElementById('table-preview');
		var typeEl = document.getElementById('table-type');
		var quantEl = document.getElementById('table-quantity');
		var weightEl = document.getElementById('table-weight');
		var totalWeight = 0;
		var tr, td;
		//clear tables
		document.getElementById('table-remove').innerHTML = '';
		document.getElementById('table-preview').innerHTML = '';
		document.getElementById('table-type').innerHTML = '';
		document.getElementById('table-price').innerHTML = '';
		document.getElementById('table-quantity').innerHTML = '';
		document.getElementById('table-weight').innerHTML = '';
		if(!cart_items || cart_items.length <= 0){
			document.getElementById('tables').style.display = 'none';
			document.getElementById('bag-state').src = 'img/bagempty.png';
			document.getElementById('shipping-total').remove();
			document.getElementById('buyermail').remove();
			document.getElementById('coupon').remove();
			document.getElementById('emailvalidator').remove();
			document.getElementById('grand-total').remove();
			document.getElementById('coupon-status').remove();
		}
		else{
			document.getElementById('tables').style.display = 'block';
			document.getElementById('bag-state').src = 'img/bagfull.png';
			for(var i = 0; i < cart_items.length; ++i){
				var item = cart_items[i];
				//remove
				tr = document.createElement('tr');
				td = document.createElement('td');
				var img = document.createElement('img');
				img.src = 'img/bagdelete.png';
				img.classList.add('hoverable');
				img.onclick = removeFromCart;
				td.appendChild(img);
				tr.appendChild(td);
				document.getElementById('table-remove').appendChild(tr);
				//create preview
				var critterType = getCritterType(item);
				var jimg;
				var bgBoxSize = 50;
				var baseOffset = 10;
				switch(item.category){
					case categories.STUFFIE.CATEGORY:{
						//critter
						var jimg, jbody, jhead, jarm;
						var jimgprom = JimpCreate(300, 340).then(img => jimg = img);
						var bodyprom = Jimp.read(critters[critterType].BODY).then(img => jbody = img);
						var armprom = Jimp.read(critters[critterType].ARMS[item.variation]).then(img => jarm = img);
						var headprom = Jimp.read(critters[critterType].HEAD).then(img => jhead = img);
						await Promise.all([jimgprom, bodyprom, headprom, armprom]);
						//makes critter
						jimg.composite(jbody, baseOffset, baseOffset);
						if(item.accessory >= 0 && item.accessory < critters[critterType].ACCESSORIES.length){
							//load accessory
							var acc = critters[critterType].ACCESSORIES[item.accessory];
							var jacc = await Jimp.read(acc.IMG);
							//if arm is behind accessory
							if(!critters[critterType].ACCESSORIES[item.accessory].BEHIND_ARMS[item.variation]){
								if(item.variation === 2) //this arm is above face
									jimg.composite(jhead, baseOffset, baseOffset);
								jimg.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2) //this arm is below face
									jimg.composite(jhead, baseOffset, baseOffset);
								//accessory
								jimg.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
							}
							else{
								//arm above accessory
								if(item.variation === 2){ //this arm is above face
									jimg.composite(jhead, baseOffset, baseOffset);
									jimg.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
								jimg.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2){ //this arm is below face
									jimg.composite(jhead, baseOffset, baseOffset);
									jimg.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
							}
						}
						else{
							//there are no accessories
							if(item.variation === 2) //this arm is above face
								jimg.composite(jhead, baseOffset, baseOffset);
							jimg.composite(jarm, baseOffset, baseOffset);
							if(item.variation < 2) //this arm is below face
								jimg.composite(jhead, baseOffset, baseOffset);
						}
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
					case categories.PIN.CATEGORY:{
						//critter
						var jimg, jcrit;
						var jimgprom = JimpCreate(300, 400).then(img => jimg = img);
						var imgprom = Jimp.read(critters[critterType].HEAD).then(img => jcrit = img);
						await Promise.all([jimgprom, imgprom]);
						if(item.accessory >= 0 && item.accessory < critters[critterType].ACCESSORIES.length){
							var acc = critters[critterType].ACCESSORIES[item.accessory];
							var jacc = await Jimp.read(acc.IMG);
							jcrit.composite(jacc, acc.POSX, acc.POSY);
						}
						//adds critter to preview
						jimg.composite(jcrit, baseOffset, baseOffset);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.65, bgBoxSize*0.65);

						break;
					}
					case categories.CHARM.CATEGORY:{
						//critter
						var jimg, jcrit, jbase, jbody, jhead, jarm;
						var baseprom = Jimp.read('img/charmbase.png').then(img => jbase = img);
						var jimgprom = JimpCreate(300, 340).then(img => jimg = img);
						var critprom = JimpCreate(300, 340).then(img => jcrit = img);
						var bodyprom = Jimp.read(critters[critterType].BODY).then(img => jbody = img);
						var armprom = Jimp.read(critters[critterType].ARMS[item.variation]).then(img => jarm = img);
						var headprom = Jimp.read(critters[critterType].HEAD).then(img => jhead = img);
						await Promise.all([jimgprom, critprom, baseprom, bodyprom, headprom, armprom]);
						//makes critter
						jcrit.composite(jbody, baseOffset, baseOffset);
						if(item.accessory >= 0 && item.accessory < critters[critterType].ACCESSORIES.length){
							//load accessory
							var acc = critters[critterType].ACCESSORIES[item.accessory];
							var jacc = await Jimp.read(acc.IMG);
							//if arm is behind accessory
							if(!critters[critterType].ACCESSORIES[item.accessory].BEHIND_ARMS[item.variation]){
								if(item.variation === 2) //this arm is above face
									jcrit.composite(jhead, baseOffset, baseOffset);
								jcrit.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2) //this arm is below face
									jcrit.composite(jhead, baseOffset, baseOffset);
								//accessory
								jcrit.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
							}
							else{
								//arm above accessory
								if(item.variation === 2){ //this arm is above face
									jcrit.composite(jhead, baseOffset, baseOffset);
									jcrit.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
								jcrit.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2){ //this arm is below face
									jcrit.composite(jhead, baseOffset, baseOffset);
									jcrit.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
							}
						}
						else{
							//there are no accessories
							if(item.variation === 2) //this arm is above face
								jcrit.composite(jhead, baseOffset, baseOffset);
							jcrit.composite(jarm, baseOffset, baseOffset);
							if(item.variation < 2) //this arm is below face
								jcrit.composite(jhead, baseOffset, baseOffset);
						}
						//adds critter to preview
						jbase.resize(Jimp.AUTO, categories.CHARM.PREVIEW.BASE.HEIGHT);
						jcrit.resize(Jimp.AUTO, categories.CHARM.PREVIEW.HEIGHT);
						jcrit.autocrop();
						jimg.composite(jbase, jimg.bitmap.width/2-jbase.bitmap.width/2, baseOffset);
						jimg.composite(jcrit, jimg.bitmap.width/2-jcrit.bitmap.width/2, baseOffset+jbase.bitmap.height-40);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
					case categories.EARRING.CATEGORY:{
						//critter
						var jimg, jbase, jcrit;
						var jimgprom = JimpCreate(300, 400).then(img => jimg = img);
						var baseprom = Jimp.read('img/earringbase.png').then(img => jbase = img);
						var imgprom = Jimp.read(critters[critterType].HEAD).then(img => jcrit = img);
						await Promise.all([jimgprom, baseprom, imgprom]);
						if(item.choker_accessory >= 0 && item.choker_accessory < critters[critterType].CHOKER_ACCESSORIES.length){
							var acc = critters[critterType].CHOKER_ACCESSORIES[item.choker_accessory];
							var jacc = await Jimp.read(acc.IMG);
							jcrit.composite(jacc, acc.POSX, acc.POSY);
						}
						//adds critter to preview
						jcrit.resize(Jimp.AUTO, categories.EARRING.PREVIEW.HEIGHT);
						jbase.resize(Jimp.AUTO, categories.EARRING.PREVIEW.BASE.HEIGHT);
						var offx1 = 10;
						jimg.composite(jbase, baseOffset+offx1, baseOffset);
						jimg.composite(jcrit, baseOffset+categories.EARRING.PREVIEW.LEFT-jcrit.bitmap.width/2, baseOffset+categories.EARRING.PREVIEW.TOP);
						var offx2 = 80;
						jimg.composite(jbase, baseOffset+offx2, baseOffset);
						jimg.composite(jcrit, baseOffset+offx2-offx1+categories.EARRING.PREVIEW.LEFT-jcrit.bitmap.width/2, baseOffset+categories.EARRING.PREVIEW.TOP);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
					case categories.CHOKER.CATEGORY:{
						//critter
						var jbase, jcrit;
						var jimgprom = JimpCreate(500, 500).then(img => jimg = img);
						var baseprom = Jimp.read(chokers[item.choker_variation]).then(img => jbase = img);
						var imgprom = Jimp.read(critters[critterType].HEAD).then(img => jcrit = img);
						await Promise.all([jimgprom, baseprom, imgprom]);
						if(item.choker_accessory >= 0 && item.choker_accessory < critters[critterType].CHOKER_ACCESSORIES.length){
							var acc = critters[critterType].CHOKER_ACCESSORIES[item.choker_accessory];
							var jacc = await Jimp.read(acc.IMG);
							jcrit.composite(jacc, acc.POSX, acc.POSY);
						}
						//adds critter to preview
						jcrit.resize(Jimp.AUTO, categories.CHOKER.PREVIEW.HEIGHT);
						jbase.resize(categories.CHOKER.PREVIEW.BASE.WIDTH, Jimp.AUTO);
						jimg.composite(jbase, jimg.bitmap.width/2-jbase.bitmap.width/2, 20);
						jimg.composite(jcrit, categories.CHOKER.PREVIEW.LEFT-jcrit.bitmap.width/2, categories.CHOKER.PREVIEW.TOP);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
				}
				//applies bg and converts to base64
				var bg = await Jimp.read('img/bagbox.png');
				bg.composite(jimg, bg.bitmap.width/2-jimg.bitmap.width/2, (bg.bitmap.height-jimg.bitmap.height)/2);
				bg.getBase64Async(Jimp.MIME_PNG)
				.then(bg64 =>{
					tr = document.createElement('tr');
					td = document.createElement('td');
					img = document.createElement('img');
					img.src = bg64;
					img.name = 'item-preview';
					td.appendChild(img);
					tr.appendChild(td);
					document.getElementById('table-preview').appendChild(tr);
				});
				//type
				tr = document.createElement('tr');
				td = document.createElement('td');
				td.innerHTML = item.category;
				tr.appendChild(td);
				document.getElementById('table-type').appendChild(tr);
				//price
				tr = document.createElement('tr');
				td = document.createElement('td');
				td.innerHTML = '$'+getItemPrice(item.category);
				tr.appendChild(td);
				document.getElementById('table-price').appendChild(tr);
				//quantity
				tr = document.createElement('tr');
				td = document.createElement('td');
				td.innerHTML = 1;
				tr.appendChild(td);
				document.getElementById('table-quantity').appendChild(tr);
				//weight
				tr = document.createElement('tr');
				td = document.createElement('td');
				var w = getItemWeight(item.category);
				if(!isNaN(w) && isFinite(w)){
					td.innerHTML = w+'g';
					totalWeight += w;
				}
				tr.appendChild(td);
				document.getElementById('table-weight').appendChild(tr);
			}
			//total weight
			tr = document.createElement('tr');
			td = document.createElement('td');
			td.innerHTML = '<b>total weight :</b>';
			tr.appendChild(td);
			document.getElementById('table-quantity').appendChild(tr);
			tr = document.createElement('tr');
			td = document.createElement('td');
			td.innerHTML = '<b>'+totalWeight+'g</b>';
			tr.appendChild(td);
			document.getElementById('table-weight').appendChild(tr);
			//sets final price
			calculateFinalPrice();
		}
	}

	//load cart from to cookies
	function loadCart(){
		if(!loadingSomething){
			var cartCookie = getCookie("cart_items");
			if(cartCookie){
				var cart = JSON.parse(cartCookie);
				if(Array.isArray(cart) && cart.length > 0){
					cart_items = cart;
				}
			}
			updateCart();
		}
		else{
			setTimeout(loadCart, 50); //retry in 50ms
		}
	}

	function clearCart(){
		setCookie("cart_items", JSON.stringify([]));
		deleteCookie("cart_items");
	}

	var oldCouponCode = '';
	var appliedDiscount = 0;
	async function checkCoupon(){
		var couponEl = document.getElementById('coupon');
		var code = couponEl.value;
		var statusEl = document.getElementById('coupon-status');
		if(code){
			oldCouponCode = code;
			var req = await fetch(api_path+'/coupon?code='+code, {method: 'GET'});
			var res = await req.json();
			if(res && res.discount){
				statusEl.style.display = 'block';
				statusEl.src = 'img/couponok.png';
				appliedDiscount = res.discount;
			}
			else{
				statusEl.style.display = 'block';
				statusEl.src = 'img/couponwrong.png';
				appliedDiscount = 0;
			}
		}
		else if(oldCouponCode){
			statusEl.style.display = 'block';
			statusEl.src = 'img/couponwrong.png';
			appliedDiscount = 0;
		}
		calculateFinalPrice();
	}

	async function finishOrder(){
		//loading overlay
		var pooftiesLoadingOverlay;
		function showLoadingOverlay(){
			pooftiesLoadingOverlay = document.createElement('div');
			pooftiesLoadingOverlay.style.background = 'rgba(255, 255, 255, 0.3)';
			pooftiesLoadingOverlay.style.zIndex = 9999;
			pooftiesLoadingOverlay.style.position = 'fixed';
			pooftiesLoadingOverlay.style.top = 0;
			pooftiesLoadingOverlay.style.left = 0;
			pooftiesLoadingOverlay.style.right = 0;
			pooftiesLoadingOverlay.style.bottom = 0;
			pooftiesLoadingOverlay.style.width = '100%';
			pooftiesLoadingOverlay.style.height = '100%';
			document.body.insertBefore(pooftiesLoadingOverlay, document.body.firstChild);
		}

		function hideLoadingOverlay(){
			if(pooftiesLoadingOverlay)
				pooftiesLoadingOverlay.remove();
		}

		try{
			//get code
			var urlSearchParams = new URLSearchParams(window.location.search);
			var params = Object.fromEntries(urlSearchParams.entries());
			var spCode = params.code;
			//other params
			var buyerMailEl = document.getElementById('buyermail');
			var buyerMail = buyerMailEl.value;
			var couponEl = document.getElementById('coupon');
			var usedCoupon = couponEl.value;
			var previews = document.getElementsByName('item-preview');
			var formData = JSON.stringify({
				buyerMail: buyerMail,
				specialCode: spCode,
				coupon: usedCoupon,
				items: cart_items
			});

			showLoadingOverlay();
			return fetch(api_path+'/order/special', {
				method: 'POST',
				cache: 'no-cache',
				headers:{
					'Content-Type': 'application/json'
				},
				body: formData
			})
			.then((res) =>{
				if(res.status !== 200)
					throw res.status;
					
				//done
				document.getElementById('tables').style.display = 'none';
				document.getElementById('bag-state').src = 'img/bagdone.png';
				document.getElementById('shipping-total').remove();
				document.getElementById('buyermail').remove();
				document.getElementById('coupon').remove();
				document.getElementById('emailvalidator').remove();
				document.getElementById('grand-total').remove();
				document.getElementById('coupon-status').remove();
				clearCart();
			})
			.catch(err => {console.log(err); alert('something went wrong!');})
			.finally(() => hideLoadingOverlay());
		}
		catch(err){
			console.log(err);
		}
	}
</script>

<img style="position: absolute;
	left: 340px;
	top: 20px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 1;" src="./img/specialshoppingbag.png">

<a href="/privacy">
<img style="position: absolute;
	left: 350px;
	top: 450px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/privacybutton.png"></a>

<a href="/">
<img style="position: absolute;
	left: 365px;
	top: 485px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/homeleft.png"></a>

<img id="bag-state" style="position: absolute;
	left: 475px;
	top: 165px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/bagfull.png">

<div id="tables" style="position: absolute; left: 450px; top: 190px;
overflow: auto; overflow: scroll; z-index: 5; width:370px; height:175px;
background: transparent; resize: none; outline:none;
border: 0px; color: #917979; font-family: Calibri;
font-size: 11px; letter-spacing:1px; line-height:20px;">

<div style="position: absolute; left:10px; right:10px;">
	<div style="display: flex;">
		<table id="table-remove" style="position: relative;"></table>
		<table id="table-preview" style="position: relative;"></table>
		<table id="table-type" style="position: relative;"></table>
		<table id="table-quantity" style="position: relative;"></table>
		<table id="table-price" style="position: relative; left: 10px;"></table>
		<table id="table-weight" style="position: relative; left: 55px;"></table>
	</div>
</div>

</div>

<p id="shipping-total" style="font-size: 10pt; font-weight: bold; text-align: right; position: absolute; top: 350px; left: 625px; z-index: 20;"></p>
<p id="grand-total" style="font-size: 11pt; font-weight: bold; text-align: right; position: absolute; top: 475px; left: 530px; z-index: 20;"></p>

<style>
::placeholder { color:#bda4a4; opacity: 1; }
::-ms-input-placeholder { color:#bda4a4; opacity: 1; }
</style>

<input id="buyermail" maxlength="50" style="position: absolute; left: 620px; top: 413px;
overflow: hidden; z-index: 5; width: 155px; height:20px;
background: transparent; resize: none; padding:5px; outline:none;
border: 0px; cursor: url(./img/cursorwrite.png), progress; font-family: Calibri;
font-size: 11px; color:#998585; letter-spacing:1px; line-height:15px; font-weight:bold;" oninput="validateEmail(this.value);"></input>

<img id="emailvalidator" style="display: none; z-index: 20; position: absolute; top: 420px; left: 785px;">

<input id="coupon" maxlength="8" style="position: absolute; left: 638px; top: 456px;
overflow: hidden; z-index: 5; width: 65px; height:20px;
background: transparent; resize: none; padding:5px; outline:none;
border: 0px; cursor: url(./img/cursorwrite.png), progress; color: #fff; font-family: Calibri;
font-size: 11px; letter-spacing:1px; line-height:15px; font-weight:bold;" onblur="checkCoupon();"></input>

<img id="coupon-status" style="display: none; z-index: 20; position: absolute; top: 458px; left: 715px;">

<img id="bag-total" style="position: absolute;
	left: 475px;
	top: 410px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/bagtotal.png">

<img src="./img/specialnotebag.png" style="position: absolute; z-index: 2; top: 565px; left: 685px;">

<script>loadCart();</script>
<img src="./img/specialcheckout.png" onclick="finishOrder();" class="hoverable" style="position: absolute; z-index: 2; top: 525px; left: 485px;">

</div>
</body>

<!--
　　　          ___   .--.
　　　    .--.-"   "-' .- |
　　　   / .-,`          .'   
　　　   \   `           \ 　　　　　　。・゜ 　♡   。　　・　゜ 　　　♡  
　　　    '.            ・ \　　　　　　　　　　　　　　　　　　　　　　　　♡　　　　♡ ゜・。。♡  
　　　      |  ・     ᴥ    。|　　　　・゜♡ ゜・。　　. * ・ ♡ °  . 。
　　　      \ 。            /.____　　　　　　　　　　　　　　　　　　♡.  
　　　     /`-.          ,'.'    `\　　　　　　　　　　　　　　　　　　。・゜　　　 ♡ ・ 。　　。・゜ ♡  
　　　  __/   \`-.____.-' `\      /　　　　　♡　。・゜      
　　　  | `---`'-'._/-`     \----'    _ 　　　　　　　　　　　 ♡　　　.　　　.♡ 
　　　  |,-'`  /             |    _.-' `\　　　　. * ・        
　　　 .'     /              |--'`     / |　　　　　　　　　　 ♡
　　　/      /\              `         | |
　　　|   .\/  \      .--. __          \ |　　　　　© middlepot.com  ꒰ ू´ ˘ ` ू ꒱
　　　 '-'      '._       /  `\         /
　　　             `\    '     |------'`　　　　。・゜　　　 ♡ ・ 。　　。・゜ ♡  
　　　               \  |      |
　　　                \        /　　　　　 ♡　　　.　　　.♡              . * ・  ♡
 　　　                '._  _.'
-->

</html>